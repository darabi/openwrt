--- a/tests/CMakeLists.txt
+++ b/tests/CMakeLists.txt
@@ -17,24 +17,25 @@ ADD_DEFINITIONS("-DMYSQL_CLIENT")
 
 INCLUDE_DIRECTORIES(${CMAKE_SOURCE_DIR}/include)
 
-ADD_EXECUTABLE(mysql_client_test mysql_client_test.c)
-TARGET_LINK_LIBRARIES(mysql_client_test mysqlclient)
-SET_TARGET_PROPERTIES(mysql_client_test PROPERTIES LINKER_LANGUAGE CXX)
-
 IF(WITH_UNIT_TESTS)
+
+  ADD_EXECUTABLE(mysql_client_test mysql_client_test.c)
+  TARGET_LINK_LIBRARIES(mysql_client_test mysqlclient)
+  SET_TARGET_PROPERTIES(mysql_client_test PROPERTIES LINKER_LANGUAGE CXX)
+
   ADD_EXECUTABLE(bug25714 bug25714.c)
   TARGET_LINK_LIBRARIES(bug25714 mysqlclient)
   SET_TARGET_PROPERTIES(bug25714 PROPERTIES LINKER_LANGUAGE CXX)
-ENDIF()
 
-INSTALL(TARGETS mysql_client_test DESTINATION ${INSTALL_BINDIR} COMPONENT Test)
+  INSTALL(TARGETS mysql_client_test DESTINATION ${INSTALL_BINDIR} COMPONENT Test)
 
-CHECK_INCLUDE_FILE(event.h HAVE_EVENT_H)
-FIND_LIBRARY(EVENT_LIBRARY event)
-MARK_AS_ADVANCED(EVENT_LIBRARY)
-IF(HAVE_EVENT_H AND EVENT_LIBRARY)
-  ADD_EXECUTABLE(async_queries async_queries.c)
-  TARGET_LINK_LIBRARIES(async_queries mysqlclient ${EVENT_LIBRARY})
-  SET_TARGET_PROPERTIES(async_queries PROPERTIES LINKER_LANGUAGE CXX)
+  CHECK_INCLUDE_FILE(event.h HAVE_EVENT_H)
+  FIND_LIBRARY(EVENT_LIBRARY event)
+  MARK_AS_ADVANCED(EVENT_LIBRARY)
+  IF(HAVE_EVENT_H AND EVENT_LIBRARY)
+    ADD_EXECUTABLE(async_queries async_queries.c)
+    TARGET_LINK_LIBRARIES(async_queries mysqlclient ${EVENT_LIBRARY})
+    SET_TARGET_PROPERTIES(async_queries PROPERTIES LINKER_LANGUAGE CXX)
 
+  ENDIF()
 ENDIF()
